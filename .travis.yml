language: ruby
rvm:
 - 2.5.1
sudo: required # temporary travis-recommended workaround, routes to older (known to work) env
cache: bundler
dist: trusty
env:
  MYSQL_DB_HOST=127.0.0.1
addons:
  apt:
   sources:
    - mysql-5.7-trusty
   packages:
    - mysql-server
    - mysql-client
# before_install:
#   - sudo mysql -e "use mysql; update user set authentication_string=PASSWORD('new_password') where User='root'; update user set plugin='mysql_native_password';FLUSH PRIVILEGES;"
#   - sudo mysql_upgrade -u root -pnew_password
#   - sudo service mysql restart

before_install:
  - mysql -e 'CREATE DATABASE hyraxdb_test;'

jdk:
  - oraclejdk8
before_script:
  - bundle exec rake db:create
script:
  - xvfb-run -a bundle exec rake ci
services:
  - redis-server
